## 何时使用AIDL，何时使用LocalBinder

在官网上，有介绍，何时使用AIDL，何时直接使用Binder类（即LocalBinder）。

在 Android 上，一个进程通常无法访问另一个进程的内存。但有时候，两个进程之间，可能需要操作同一个对象。编写具备这样特性的应用，需要花费巨大的力量，因此，android上使用AIDL来简化这个过程。

使用AIDL的两个必要条件：
1. 你的服务是跨进程访问的。
2. 你的服务是支持并发的。

否则，如果你的服务不是跨进程的（不管是否并发），那么使用
* 自实现Binder（即Local Binder）

> 本地Binder的线程问题，取决于调用方的线程，和本地调用没什么区别。换言之，你需要并发，则将Service设计成并发，然后在多线程中调用接口；如果你不需要并发，则可以控制调用接口的线程为单线程。

否则，如果你的服务是跨进程的，但不支持并发，那么使用
* Messenger


回个头来，为什么使用AIDL的先决条件是跨进程和并发呢？
1. 既然是跨进程，那么就不能避免多进程共存的情况，也就是说并发是天然存在的。
2. AIDL跨应用时，客户端每一次调用，在服务端都是一个子线程。所以即使一个客户端，同时多个调用，也会产生线程问题。

从AIDL的调用线程来看（另一篇）AIDL在同一个应用中绑定的时候，其实走的也是本地Binder。只有在另一个应用绑定时，才会是跨应用访问。

另外，程序是你开发的，你完全可以控制只有一个客户端进程，并且控制好服务端在同一个线程内执行。

#### AIDL的线程问题

官网上也有说，顺便带一下。虽然另一篇已说。

* 本地进程调用（同一个应用内）

AIDL在本地进程中调用。AIDL的调用线程和执行线程是一致的。调用在UI线程，则执行也在UI线程；调用在子线程，则执行也在子线程。（官网也强调了，如果是这种情况，根本不应该使用AIDL，而应该使用本地Binder）

* 跨进程调用（不同应用内）

AIDL在跨进程中调用。调用方的线程不管。服务端的执行是分配在一个线程池中执行的。**换句话，跨进程中，AIDL的接口实现必须是线程安全的！**

* oneway调用

这个比较重要，之前也忽略了。默认情况下，AIDL跨进程调用是**阻塞的**，和普通函数调用一样，只是隐藏了跨进程的细节。如果需要调用立即返回，而不等待执行过程，那么可以使用`oneway`关键字。

`oneway`关键字只有在跨进程调用中生效；对于本地进程调用，仍旧是同步的。
