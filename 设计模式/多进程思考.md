## 多进程的思考

### 微信等多进程方案

微信有多个进程：

* com.tencent.mm
* com.tencent.mm:tools
* com.tencent.mm:push
* com.tencent.mm.extdevice
* com.tencent.mm.appbrand0

微信移动开发团队在 《Android内存优化杂谈》 一文中就说到：“对于webview，图库等，由于存在内存系统泄露或者占用内存过多的问题，我们可以采用单独的进程。微信当前也会把它们放在单独的tools进程中”。

为什么呢？

如果在app中，增加了一个很常用的`图片选择模块`用于`上传图片或者头像`，加载大量Bitmap会使app的内存占用迅速增加，如果你还把查看过的图片缓存在了内存中，那么OOM的风险将会大大增加，如果此时还需要使用WebView加载一波网页，我就问你怕不怕！

所以，可见，用途在于，某个业务过程需要大内存，但业务结果只是单一的小内存。并不是把图片缓存在另一个进程。

IPC Binder



微信移动开发团队在 《Android内存优化杂谈》 一文中就说到：“对于webview，图库等，由于存在内存系统泄露或者占用内存过多的问题，我们可以采用单独的进程。微信当前也会把它们放在单独的tools进程中”。

例如：把选择图片模块放到独立的进程，我们仍可以使用startActivityForResult方法，将选中的图片放到Bundle中，使用Intent传递即可。（看到这里，你还不打算把你项目的图片选择弄到独立进程么？）

即使使用process:remote把一个Activity放到子进程，Application还是重新创建的一个。

多进程的优点和使用场景，之前在《Android多进程使用场景》中也做过介绍，大体优点有这么几个：

- 提高各个进程的稳定性，单一进程崩溃后不影响整个程序。
- 对于内存的时候更可控，可以通过手工释放进程，达到内存优化目的。
- 基于独立的JVM，各个模块可以充分解耦。
- 只保留daemon进程的情况下，会使应用存活时间更长，不容易被回收掉。

但是启用多进程，那就意味着Router系统的失效。Router是JVM级别的单例模式，并不支持跨进程访问。也就是说，你的后台进程的所有Provider、Action，是注册给后台Router的。当你在前台进程调用的时候，根本调用不到其他进程的Action。


这就和Http请求很像了。这样做的好处就是对后续WebView上可以非常便利得直接调用本地Action。
